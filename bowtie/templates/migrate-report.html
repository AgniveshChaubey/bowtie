<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Bowtie â€“</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg sticky-top mb-4">
      <div class="container-fluid">
        <a class="navbar-brand mb-0 h1" href="#">Bowtie</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="#run-info">Run Info</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#summary">Summary</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#cases">Details</a>
            </li>
          </ul>
        </div>
        <button id="theme-toggler" class="btn border-0 me-1"></button>

        <a
          href="https://github.com/bowtie-json-schema/bowtie/"
          class="link-secondary"
        >
          <span class="navbar-text">
            <small id="bowtie-version">Bowtie v - </small>
          </span>
        </a>
      </div>
    </nav>

    <div class="container p-4">
      <div class="card mx-auto mb-3 w-75" id="run-info">
        <div class="card-header">Run Info</div>
        <div class="card-body">
          <table class="table table-sm table-hover">
            <tr>
              <td>Dialect</td>
              <td id="dialect-link"></td>
            </tr>
            <tr>
              <td>Ran</td>
              <td>
                <time id="run-started"></time>
              </td>
            </tr>
          </table>
        </div>
      </div>

      <div class="card mx-auto mb-3 w-75" id="summary">
        <div class="card-header">Summary</div>

        <div class="card-body">
          <table class="table table-sm table-hover">
            <thead>
              <tr>
                <th
                  colspan="2"
                  rowspan="2"
                  scope="col"
                  class="text-center align-middle"
                  style="color: white;"
                >
                  implementation
                </th>
                <th colspan="1" class="text-center">
                  <span id="total_cases" class="text-muted">cases</span>
                </th>
                <th colspan="3" class="text-center">
                  <span id="total_tests" class="text-muted">tests</span>
                </th>
                <th colspan="1"></th>
              </tr>

              <tr>
                <th scope="col" class="text-center" style="color: white;">errors</th>

                <th scope="col" class="table-bordered text-center" style="color: white;">skipped</th>
                <th
                  scope="col"
                  class="table-bordered text-center details-required"
                  style="color: white;"
                >
                  <div class="hover-details details-desc text-center" ></div>
                  unsuccessful
                </th>

                <th scope="col"></th>
              </tr>
            </thead>

            <tbody id="tbody" class="table-group-divider"></tbody>

            <tfoot>
              <tr>
                <th scope="row" colspan="2">total</th>

                <td id="summary-errored_cases" class="text-center"></td>

                <td id="summary-skipped_tests" class="text-center"></td>
                <td
                  id="summary-unsuccessful_tests"
                  class="text-center details-required"
                >
                </td>
                <td></td>
              </tr>
            </tfoot>
          </table>
          <div id="did_fail_fast" class="alert alert-warning" role="alert">

          </div>
        </div>
      </div>
      <div class="accordion pt-5" id="cases">
        <div id="accordion-item" class="accordion-item">

        </div>
      </div>
    </div>

    <script type="module" src="../utilclasses.js"></script>
    <script type="module" src="../functions.js"></script>
  
    <!-- ////////////////////// Testing Script //////////////////////////// -->
    <script>
        async function loadFunctions() {
            const module = await import("../functions.js");
            const Calculator = module.Calculator;

            const calculator = new Calculator();
            //console.log(calculator.sum(4, 55));
            //console.log(calculator.greet(4));
        }
      document.addEventListener("DOMContentLoaded", loadFunctions);
    </script>
    <!-- ///////////////////////////////////////////////////////////////// -->

    <script>
      async function jsonData(dataObjectsArray, generate_dialect_navigation = false) {
        const module = await import("../utilclasses.js");
        const RunInfo = module.RunInfo;
        const CaseResult = module.CaseResult;
        const CaseSkipped = module.CaseSkipped;

        let lines = dataObjectsArray.map(line => JSON.parse(line));
        //console.log(lines)
        //console.log(RunInfo)
  
        let data = [1,2,3,4]


        let run_info = new RunInfo(...Object.values(lines[0]));
        //console.log(run_info)
        //console.log(run_info._implementations)
        let summary = run_info.create_summary();
        //console.log(summary)
        //console.log(summary.counts)


        for (let i = 1; i < lines.length; i++) {
          let each = lines[i];
          if ("case" in each) {
              summary.add_case_metadata(each);
          } else if ("caught" in each) {
              summary.see_error(each);
          } else if ("skipped" in each) {
              delete each["skipped"];
              summary.see_skip(new CaseSkipped(each));
          } else if ("did_fail_fast" in each) {
              summary.see_maybe_fail_fast(each);
          } else {
              summary.see_result(CaseResult.from_dict(each));
          }
      }
        
        function to_icon(valid) {
          if (valid === true) {
            // Circular Checkmark SVG Icon
            return `
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
              </svg>
            `;
          } else if (valid === false) {
            // Circular cross (x) SVG Icon
            return `
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z" />
              </svg>
            `;
          } else {
            // Circular warning (!) SVG Icon
            return `
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-octagon" viewBox="0 0 16 16">
                <path d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353L4.54.146zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1H5.1z" />
                <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z" />
              </svg>
            `;
          }
        };

        const titleElement = document.querySelector("title");
            titleElement.textContent += ` ${run_info.dialect_shortname}`;

            //adding bowtie version
            var bowtieVersion = document.getElementById("bowtie-version");
            bowtieVersion.textContent += `${run_info.bowtie_version}`;

            //adding dialect link in #run-info
            var dialectLink = document.querySelector("#dialect-link");
            dialectLink.textContent = `${run_info.dialect}`;

            let ago = (Date.now() - Date.parse(`${run_info.started}`)) / 1000;
            let agoUnits = "seconds";
            if (ago > 60) {
              ago /= 60;
              agoUnits = "minutes";
              if (ago > 60) {
                ago /= 60;
                agoUnits = "hours";
                if (ago > 24) {
                  ago /= 24;
                  agoUnits = "days";
                  if (ago > 7) {
                    ago /= 7;
                    agoUnits = "weeks";
                  }
                }
              }
            }
            const roundedAgo = Math.round(ago);
            const formattedAgo = Number.isFinite(roundedAgo)
              ? new Intl.RelativeTimeFormat("en", { numeric: "auto" }).format(
                  -roundedAgo,
                  agoUnits
                )
              : "";
            document.getElementById("run-started").textContent = formattedAgo;

            //summary section
            var totalCases = document.getElementById("total_cases");
            totalCases.textContent += ` (${summary.total_cases})`;

            var totalTests = document.getElementById("total_tests");
            totalTests.textContent += ` (${summary.total_tests})`;

            //updating summary table
            tbody = document.getElementById("tbody");
            //console.log(typeof(summary.implementations.length))
            let implementations = summary.implementations;
            //console.log(implementations)
            for (const [index, implementation] of summary.implementations.entries()) {
              //th section of summary table's data
              let counts = summary.counts[implementation.image];
              //console.log(implementation)
              //console.log(counts)

              var tr = document.createElement("tr");
              var th = document.createElement("th");
              th.setAttribute("scope", "row");

              const a = document.createElement("a");
              a.setAttribute(
                //"id",
                //`implementation-${data.summary.implementation[i].name}`
                "href", `${implementation.homepage || implementation.issue}`
              );
              a.textContent = `${implementation.name}`;

              const smallTH = document.createElement("small");
              //smallTH.setAttribute(
                //"id",
                //`implementation-${data.summary.implementation[i].language}`
              //);
              smallTH.setAttribute("class", "text-muted");
              smallTH.textContent += " " + `${ implementation.language}`;

              th.appendChild(a);
              th.appendChild(smallTH);
              tr.appendChild(th);
              //console.log(tr)

              //td section of summary table's data
              var td = document.createElement("td");
              const smallTD = document.createElement("small");
              smallTD.setAttribute("class", "font-monospace text-muted");
              //console.log(implementation.version || "")
              smallTD.textContent = implementation.version || "";

              const buttonTD = document.createElement("button");
              buttonTD.setAttribute("class", "btn border-0");

              const svgTD = document.createElementNS(
                "http://www.w3.org/2000/svg",
                "svg"
              );
              svgTD.setAttribute("width", "16");
              svgTD.setAttribute("height", "16");
              svgTD.setAttribute("fill", "currentColor");
              svgTD.setAttribute("class", "bi bi-info-circle-fill");
              svgTD.setAttribute("viewBox", "0 0 16 16");
              svgTD.setAttribute("data-bs-toggle", "modal");
              svgTD.setAttribute(
                "data-bs-target",
                `#implementation-runtime-info`
              );

              const pathTD = document.createElementNS(
                "http://www.w3.org/2000/svg",
                "path"
              );
              pathTD.setAttribute(
                "d",
                "M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"
              );

              svgTD.appendChild(pathTD);
              buttonTD.appendChild(svgTD);

              var td = document.createElement("td");
              td.appendChild(smallTD);
              td.appendChild(buttonTD);

              tr.appendChild(td);

              //final section of table body
              var td2 = document.createElement("td");
              td2.setAttribute("class", "text-center");
              td2.textContent = `${counts.errored_cases}`;

              var td3 = document.createElement("td");
              td3.setAttribute("class", "text-center");
              td3.textContent += `${counts.skipped_tests}`;

              var td4 = document.createElement("td");
              td4.setAttribute("class", "text-center details-required");
              td4.textContent += `${
                counts.failed_tests + counts.errored_tests
              }`;
              //console.log(typeof(counts.failed_tests))

              var td5 = document.createElement("td");
              var detailButton = document.createElement("button");
              detailButton.setAttribute("type", "button");
              detailButton.setAttribute("class", "btn btn-sm btn-primary");
              detailButton.setAttribute("data-bs-toggle", "modal");
              detailButton.setAttribute("data-bs-target", `#implementation-${index}-details`);
              detailButton.textContent += "Details";

              td5.appendChild(detailButton);

              tr.appendChild(td2);
              tr.appendChild(td3);
              tr.appendChild(td4);
              tr.appendChild(td5);

              tbody.appendChild(tr);
            }

            // summary table footer (total)
            erroredCases = document.getElementById('summary-errored_cases');
            erroredCases.textContent = `${summary.errored_cases}`;

            skippedTests = document.getElementById("summary-skipped_tests");
            skippedTests.textContent = `${summary.skipped_tests}`;

            unsuccessfulTests = document.getElementById(
              "summary-unsuccessful_tests"
            );
            unsuccessfulTests.textContent = `${summary.errored_cases + summary.skipped_tests}`;


            const didFailFast = document.getElementById("did_fail_fast");
            if (summary.did_fail_fast){
              didFailFast.textContent = "This run failed fast, so some input cases may not have been run.";
            };


            // cases section (accordions)
            
            var flatResults = Array.from(summary.flat_results());
            console.log(flatResults)
            console.log(summary.flat_results())
            const accordionCases = document.getElementById('cases');
            const accordionItems = document.getElementById('accordion-item');

            flatResults.forEach(function(item) {
              var seq = item[0];
              var description = item[1];
              var schema = item[2];
              var registry = item[3];
              var results = item[4];
              

              // creating h2 element
              const accordionItemsH2 = document.createElement('h2');
              accordionItemsH2.setAttribute("class", "accordion-header");
              accordionItemsH2.setAttribute("id", `case-${ seq }-heading`);

              const accordionItemsButton = document.createElement("button");
              accordionItemsButton.setAttribute("class", "accordion-button collapsed");
              accordionItemsButton.setAttribute("type", "button");
              accordionItemsButton.setAttribute('data-bs-toggle', 'collapse');
              accordionItemsButton.setAttribute('data-bs-target', `#case-${ seq }`);
              accordionItemsButton.setAttribute('aria-expanded', 'false');
              accordionItemsButton.setAttribute('aria-controls', 'case-${ seq }');

              accordionItemsButton.onclick = function() {
                schemaDisplay(`accordion-body${ seq }`, JSON.stringify(schema, null, 2), "schema-code", `row-${ seq }`);
              };

              const accordionItemsA = document.createElement("a");
              accordionItemsA.setAttribute("href", "#schema");
              accordionItemsA.setAttribute("class", "text-decoration-none");
              accordionItemsA.textContent += description;

              // appending the elements to create 'h2' element
              accordionItemsButton.appendChild(accordionItemsA);
              accordionItemsH2.appendChild(accordionItemsButton);
              console.log(accordionItemsH2)


              // creating the div element
              const accordionItemsDiv = document.createElement("div");
              accordionItemsDiv.setAttribute("id", `case-${ seq }`);
              accordionItemsDiv.setAttribute("class", "accordion-collapse collapse");
              accordionItemsDiv.setAttribute("aria-labelledby", `case-${ seq }-heading`);
              accordionItemsDiv.setAttribute("data-bs-parent", "#cases");

              const accordionItemsChildDiv = document.createElement("div");
              accordionItemsChildDiv.setAttribute("id", `accordion-body${ seq }`);
              accordionItemsChildDiv.setAttribute("class", "accordion-body");

              accordionItemsDivTable = document.createElement('table');
              accordionItemsDivTable.setAttribute("class", "table table-hover");

              const accordionItemsDivTHead = document.createElement('thead');
              const accordionItemsDivTR = document.createElement('tr');

              const accordionItemsDivTD = document.createElement('td');
              accordionItemsDivTD.setAttribute("scope", "col");
              accordionItemsDivTD.textContent = "Tests";

              //appending Child
              accordionItemsDivTR.appendChild(accordionItemsDivTD);

              for(const implementation of summary.implementations) {
                const accordionItemsDivTD2 = document.createElement('td');
                accordionItemsDivTD2.setAttribute("class", "text-center");
                accordionItemsDivTD2.setAttribute("scope", "col");
                accordionItemsDivTD2.textContent += implementation.name;

                const accordionItemsDivSmall = document.createElement('small');
                accordionItemsDivSmall.setAttribute("class", "text-muted");
                accordionItemsDivSmall.textContent += implementation.language;

                accordionItemsDivTD2.appendChild(accordionItemsDivSmall);
                accordionItemsDivTR.appendChild(accordionItemsDivTD2);
              };
              // thead appending to table
              accordionItemsDivTHead.appendChild(accordionItemsDivTR);
              accordionItemsDivTable.appendChild(accordionItemsDivTHead);

              ///////////////////////////
              for (let test in results) {
                let test_results = results[test];

                const testsTR = document.createElement('tr');
                testsTR.setAttribute("class", `row-${ seq }`);
                testsTR.addEventListener('click', function() {
                  const instanceInfo = document.getElementById('instance-info');
                  instanceInfo.textContent = JSON.stringify(test.instance, null, 2);
                });

                const testsTD = document.createElement("td");

                const testsA = document.createElement("a");
                testsA.setAttribute("href", "#schema");
                testsA.setAttribute("class", "text-decoration-none");
                testsA.textContent += test.description;

                testsTD.appendChild(testsA);
                testsTR.appendChild(testsTD);

                for (let implementation of summary.implementations) {
                  let implementation_result, incorrect;
                  [implementation_result, incorrect] = test_results.get(implementation.image, { valid: null }, true);

                  let cell = document.createElement('td');
                  let classNames = 'text-center';

                  if (incorrect === 'skipped') {
                    classNames += ' text-bg-warning';
                    cell.innerHTML = to_icon(null);
                  } else if (incorrect === 'errored') {
                    classNames += ' text-bg-danger';
                    cell.innerHTML = to_icon(null);
                  } else {
                    if (implementation_result.valid !== true && implementation_result.valid !== false) {
                      classNames += ' text-bg-warning';
                    } else if (incorrect) {
                      classNames += ' text-bg-danger';
                    }
                    cell.innerHTML = to_icon(implementation_result.valid);
                  }

                  cell.className = classNames;
                  testsTR.appendChild(cell);
                };
                accordionItemsDivTable.appendChild(testsTR);
              };

              //updating the child div elements
              accordionItemsChildDiv.append(accordionItemsDivTable);
              accordionItemsDiv.appendChild(accordionItemsChildDiv);
            });
            accordionCases.appendChild(accordionItems);


            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            // Retrieve the container element where the modals will be inserted
            var container = document.getElementById("modal-container");

            // Iterate over the implementations data
            for (var i = 0; i < summary.implementations.length; i++) {
              var implementation = summary.implementations[i];

              //Details Modal
              var detailsModal = document.createElement("div");
              detailsModal.className = "modal fade";
              detailsModal.id = "implementation-" + (i + 1) + "-details";
              detailsModal.setAttribute("tabindex", "-1");
              detailsModal.setAttribute("aria-labelledby", "implementation-" + (i + 1) + "-details-label");
              detailsModal.setAttribute("aria-hidden", "true");

              var modalDialog = document.createElement("div");
              modalDialog.className = "modal-dialog modal-fullscreen";

              var modalContent = document.createElement("div");
              modalContent.className = "modal-content";

              // Creating modal header
              var modalHeader = document.createElement("div");
              modalHeader.className = "modal-header";

              var modalTitle = document.createElement("h1");
              modalTitle.className = "modal-title fs-5";
              modalTitle.id = "implementation-" + (i + 1) + "-details-label";
              modalTitle.textContent = implementation.name;

              var small = document.createElement("small");
              small.className = "text-muted";
              small.textContent = implementation.language;

              modalTitle.appendChild(small);
              modalHeader.appendChild(modalTitle);

              var closeButton = document.createElement("button");
              closeButton.type = "button";
              closeButton.className = "btn-close";
              closeButton.setAttribute("data-bs-dismiss", "modal");
              closeButton.setAttribute("aria-label", "Close");

              modalHeader.appendChild(closeButton);
              modalContent.appendChild(modalHeader);

              // Creating modal body
              var modalBody = document.createElement("div");
              modalBody.className = "modal-body";

              var row = document.createElement("div");
              row.className = "row row-cols-1 row-cols-md-2 g-4";

              var flatResults = Array.from(summary.flat_results());
              for (var j = 0; j < flatResults.length; j++) {
                var result = flatResults[j];
                var test = result[0];
                var testResults = result[1];
                var implementationResult = testResults.get(implementation.image);

                // Creating card element
                var col = document.createElement("div");
                col.className = "col";

                var card = document.createElement("div");
                card.className = "card";

                var cardBody = document.createElement("div");
                cardBody.className = "card-body";

                var cardTitle = document.createElement("h5");
                cardTitle.className = "card-title";
                cardTitle.textContent = test[1];

                var cardText = document.createElement("p");
                cardText.className = "card-text";
                cardText.textContent = test[0].description;

                cardBody.appendChild(cardTitle);
                cardBody.appendChild(cardText);
                card.appendChild(cardBody);

                var cardFooter = document.createElement("div");
                cardFooter.className = "card-footer text-muted text-center";

                if (implementationResult[1] === "skipped") {
                  card.className += " border-warning";
                  cardFooter.textContent = implementationResult[0];
                } else if (implementationResult[1] === "errored") {
                  card.className += " border-danger";
                  cardFooter.textContent = implementationResult[0];
                } else if (implementationResult[1]) {
                  card.className += " border-danger";
                  var validText = implementationResult[0].valid ? "valid" : "invalid";
                  cardFooter.textContent = "Unexpectedly " + validText;
                }

                card.appendChild(cardFooter);
                col.appendChild(card);
                row.appendChild(col);
              }

              modalBody.appendChild(row);
              modalContent.appendChild(modalBody);

              // Creating modal footer
              var modalFooter = document.createElement("div");
              modalFooter.className = "modal-footer";

              var closeButton = document.createElement("button");
              closeButton.type = "button";
              closeButton.className = "btn btn-secondary";
              closeButton.setAttribute("data-bs-dismiss", "modal");
              closeButton.textContent = "Close";

              modalFooter.appendChild(closeButton);
              modalContent.appendChild(modalFooter);

              modalDialog.appendChild(modalContent);
              detailsModal.appendChild(modalDialog);

              /////////////////////
              //runtime-info Modal
              var runtimeInfoModal = document.createElement("div");
              runtimeInfoModal.className = "modal fade";
              runtimeInfoModal.setAttribute("role", "dialog");
              runtimeInfoModal.id = "implementation-" + (i + 1) + "-runtime-info";
              runtimeInfoModal.setAttribute("tabindex", "-1");
              runtimeInfoModal.setAttribute("aria-labelledby", "implementation-" + (i + 1) + "-runtime-info-label");
              runtimeInfoModal.setAttribute("aria-hidden", "true");

              var runtimeInfoDialog = document.createElement("div");
              runtimeInfoDialog.className = "modal-dialog";
              runtimeInfoDialog.setAttribute("role", "document");

              var runtimeInfoContent = document.createElement("div");
              runtimeInfoContent.className = "modal-content";

              // Creating runtime info modal header
              var runtimeInfoHeader = document.createElement("div");
              runtimeInfoHeader.className = "modal-header";

              var runtimeInfoTitle = document.createElement("h5");
              runtimeInfoTitle.className = "modal-title";
              runtimeInfoTitle.id = "implementation-" + (i + 1) + "-runtime-info-label";

              var titleText = document.createElement("b");
              titleText.textContent = implementation.name;

              var small = document.createElement("small");
              small.className = "text-muted";
              small.textContent = implementation.language;

              runtimeInfoTitle.appendChild(titleText);
              runtimeInfoTitle.appendChild(small);
              runtimeInfoHeader.appendChild(runtimeInfoTitle);

              var closeButton = document.createElement("button");
              closeButton.type = "button";
              closeButton.className = "btn-close";
              closeButton.setAttribute("data-bs-dismiss", "modal");
              closeButton.setAttribute("aria-label", "Close");

              runtimeInfoHeader.appendChild(closeButton);
              runtimeInfoContent.appendChild(runtimeInfoHeader);

              // Creating runtime info modal body
              var runtimeInfoBody = document.createElement("div");
              runtimeInfoBody.className = "modal-body";

              // Checking and appending runtime info if available
              if (implementation.os_version) {
                var osVersion = document.createElement("p");
                osVersion.innerHTML = "<strong>OS Version: </strong>" + implementation.os_version;
                runtimeInfoBody.appendChild(osVersion);
              }

              if (implementation.os) {
                var os = document.createElement("p");
                os.innerHTML = "<strong>OS: </strong>" + implementation.os;
                runtimeInfoBody.appendChild(os);
              }

              if (implementation.language) {
                var language = document.createElement("p");
                language.innerHTML = "<strong>Language: </strong>" + implementation.language;
                runtimeInfoBody.appendChild(language);
              }

              if (implementation.language_version) {
                var languageVersion = document.createElement("p");
                languageVersion.innerHTML = "<strong>Language Version: </strong>" + implementation.language_version;
                runtimeInfoBody.appendChild(languageVersion);
              }

              runtimeInfoContent.appendChild(runtimeInfoBody);

              // Crating runtime info modal footer
              var runtimeInfoFooter = document.createElement("div");
              runtimeInfoFooter.className = "modal-footer m-2 p-0";

              var closeButton = document.createElement("button");
              closeButton.type = "button";
              closeButton.className = "btn btn-sm btn-secondary";
              closeButton.setAttribute("data-bs-dismiss", "modal");
              closeButton.textContent = "Close";

              runtimeInfoFooter.appendChild(closeButton);
              runtimeInfoContent.appendChild(runtimeInfoFooter);

              runtimeInfoDialog.appendChild(runtimeInfoContent);
              runtimeInfoModal.appendChild(runtimeInfoDialog);


              ////////////////////////////////
              // Creating schema display element
              var schemaDisplay = document.createElement("div");
              schemaDisplay.id = "display-body";
              schemaDisplay.className = "card mb-3 d-none mw-100";

              var row = document.createElement("div");
              row.className = "row";
              schemaDisplay.appendChild(row);

              var col8 = document.createElement("div");
              col8.className = "col-8 pe-0";
              row.appendChild(col8);

              var highlightToolbar = document.createElement("div");
              highlightToolbar.className = "d-flex align-items-center highlight-toolbar ps-3 pe-2 py-1 border-0 border-top border-bottom";
              col8.appendChild(highlightToolbar);

              var schemaLabel = document.createElement("small");
              schemaLabel.className = "font-monospace text-body-secondary text-uppercase";
              schemaLabel.textContent = "Schema";
              highlightToolbar.appendChild(schemaLabel);

              var schemaCopyButtonContainer = document.createElement("div");
              schemaCopyButtonContainer.className = "d-flex ms-auto";
              highlightToolbar.appendChild(schemaCopyButtonContainer);

              var schemaCopyButton = document.createElement("button");
              schemaCopyButton.type = "button";
              schemaCopyButton.id = "copy-button-schema-" + (i + 1);
              schemaCopyButton.className = "btn mt-0 me-0";
              schemaCopyButton.setAttribute("onclick", 'copyToClipboard("schema-code-' + (i + 1) + '","copy-button-schema-' + (i + 1) + '")');
              schemaCopyButton.setAttribute("aria-label", "Copy to clipboard");
              schemaCopyButton.setAttribute("data-bs-toggle", "tooltip");
              schemaCopyButton.setAttribute("data-bs-placement", "top");
              schemaCopyButton.setAttribute("data-bs-custom-class", "custom-tooltip");
              schemaCopyButton.setAttribute("data-bs-title", "Copy to clipboard");

              // Clipboard SVG Icon
              var clipboardIcon = document.createElement("svg");
              clipboardIcon.setAttribute("xmlns", "http://www.w3.org/2000/svg");
              clipboardIcon.setAttribute("width", "16");
              clipboardIcon.setAttribute("height", "16");
              clipboardIcon.setAttribute("fill", "currentColor");
              clipboardIcon.setAttribute("class", "bi bi-clipboard");
              clipboardIcon.setAttribute("viewBox", "0 0 16 16");
              var clipboardIconPath1 = document.createElement("path");
              clipboardIconPath1.setAttribute("d", "M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z");
              var clipboardIconPath2 = document.createElement("path");
              clipboardIconPath2.setAttribute("d", "M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z");
              clipboardIcon.appendChild(clipboardIconPath1);
              clipboardIcon.appendChild(clipboardIconPath2);

              schemaCopyButton.appendChild(clipboardIcon);
              schemaCopyButtonContainer.appendChild(schemaCopyButton);

              var col8CardBody = document.createElement("div");
              col8CardBody.className = "card-body";
              col8CardBody.id = "schema-code-" + (i + 1);
              col8.appendChild(col8CardBody);

              var col4 = document.createElement("div");
              col4.className = "col-4 border-start ps-0";
              row.appendChild(col4);

              var instanceHighlightToolbar = document.createElement("div");
              instanceHighlightToolbar.className = "d-flex align-items-center highlight-toolbar ps-3 pe-2 py-1 border-0 border-top border-bottom";
              col4.appendChild(instanceHighlightToolbar);

              var instanceLabel = document.createElement("small");
              instanceLabel.className = "font-monospace text-body-secondary text-uppercase";
              instanceLabel.textContent = "Instance";
              instanceHighlightToolbar.appendChild(instanceLabel);

              var instanceCopyButtonContainer = document.createElement("div");
              instanceCopyButtonContainer.className = "d-flex ms-auto";
              instanceHighlightToolbar.appendChild(instanceCopyButtonContainer);

              var instanceCopyButton = document.createElement("button");
              instanceCopyButton.type = "button";
              instanceCopyButton.id = "copy-button-instance-" + (i + 1);
              instanceCopyButton.setAttribute("onclick", 'copyToClipboard("instance-info-' + (i + 1) + '","copy-button-instance-' + (i + 1) + '")');
              instanceCopyButton.className = "btn mt-0 me-0";
              instanceCopyButton.setAttribute("aria-label", "Copy to clipboard");
              instanceCopyButton.setAttribute("data-bs-toggle", "tooltip");
              instanceCopyButton.setAttribute("data-bs-placement", "top");
              instanceCopyButton.setAttribute("data-bs-custom-class", "custom-tooltip");
              instanceCopyButton.setAttribute("data-bs-title", "Copy to clipboard");

              // Clipboard SVG Icon
              var clipboardIcon2 = document.createElement("svg");
              clipboardIcon2.setAttribute("xmlns", "http://www.w3.org/2000/svg");
              clipboardIcon2.setAttribute("width", "16");
              clipboardIcon2.setAttribute("height", "16");
              clipboardIcon2.setAttribute("fill", "currentColor");
              clipboardIcon2.setAttribute("class", "bi bi-clipboard");
              clipboardIcon2.setAttribute("viewBox", "0 0 16 16");
              var clipboardIconPath3 = document.createElement("path");
              clipboardIconPath3.setAttribute("d", "M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z");
              var clipboardIconPath4 = document.createElement("path");
              clipboardIconPath4.setAttribute("d", "M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z");
              clipboardIcon2.appendChild(clipboardIconPath3);
              clipboardIcon2.appendChild(clipboardIconPath4);

              instanceCopyButton.appendChild(clipboardIcon2);
              instanceCopyButtonContainer.appendChild(instanceCopyButton);

              var col4CardBody = document.createElement("div");
              col4CardBody.className = "card-body";
              col4CardBody.id = "instance-info-" + (i + 1);
              col4.appendChild(col4CardBody);

              row.appendChild(col4);

            };

      };


    </script>
    <script>
      const script = document.createElement("script");
      script.src = "https://cdn.jsdelivr.net/npm/pako@2.0.3/dist/pako.min.js";
      document.head.appendChild(script);

      let dark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      let themeTogglerButton = document.getElementById("theme-toggler");
      script.onload = () => {
        //fetching json data
        
        fetch("https://bowtie-json-schema.github.io/bowtie/draft7.json.gz")
          .then((response) => response.arrayBuffer())
          .then((buffer) => {
             const inflated = pako.inflate(buffer, { to: "string" });
             const dataObjectsArray = inflated.trim().split(/\n(?=\{)/);
              //console.log(dataObjectsArray)
            const data = dataObjectsArray.map((line) => JSON.parse(line)); 
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            
            jsonData(dataObjectsArray);

            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            
          });
      };

      //setting datetime attribute

      //changing theme icon
      //moon icon
      var themeSvgMoon = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "svg"
      );
      themeSvgMoon.setAttribute("xmlns", "http://www.w3.org/2000/svg");
      themeSvgMoon.setAttribute("width", "20");
      themeSvgMoon.setAttribute("height", "20");
      themeSvgMoon.setAttribute("fill", "currentColor");
      themeSvgMoon.setAttribute("class", "bi bi-moon-fill");
      themeSvgMoon.setAttribute("viewBox", "0 0 16 16");
      const pathMoon = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "path"
      );
      pathMoon.setAttribute(
        "d",
        "M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"
      );
      themeSvgMoon.appendChild(pathMoon);

      //Sun Icon
      var themeSvgSun = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "svg"
      );
      themeSvgSun.setAttribute("xmlns", "http://www.w3.org/2000/svg");
      themeSvgSun.setAttribute("width", "20");
      themeSvgSun.setAttribute("height", "20");
      themeSvgSun.setAttribute("fill", "currentColor");
      themeSvgSun.setAttribute("class", "bi bi-sun");
      themeSvgSun.setAttribute("viewBox", "0 0 16 16");

      const pathSun = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "path"
      );
      pathSun.setAttribute(
        "d",
        "M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"
      );
      themeSvgSun.appendChild(pathSun);

      dark
        ? themeTogglerButton.appendChild(themeSvgMoon)
        : themeTogglerButton.appendChild(themeSvgSun);

      //adding dark theme
      const body = document.querySelector("body");
      const nav = document.querySelector("nav");
      nav.classList.add(dark ? ("navbar-dark", "bg-dark") : ("navbar-light", "bg-light"))
      body.setAttribute("data-bs-theme", dark ? "dark" : "light");

      themeTogglerButton.addEventListener("click", () => {
        body.setAttribute("data-bs-theme", dark ? "light" : "dark");
        dark = !dark;

        dark
          ? (themeTogglerButton.appendChild(themeSvgMoon),
            themeTogglerButton.removeChild(themeSvgSun))
          : (themeTogglerButton.appendChild(themeSvgSun),
            themeTogglerButton.removeChild(themeSvgMoon));
            
            nav.classList.toggle("navbar-dark", dark);
            nav.classList.toggle("bg-dark", dark);
            nav.classList.toggle("bg-light", !dark);
            nav.classList.toggle("navbar-light", !dark);
          });
    </script>
  </body>
</html>
